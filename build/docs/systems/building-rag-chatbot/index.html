<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-systems/building-rag-chatbot" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">Building the RAG Chatbot Foundation | AI-Powered Book with RAG Chatbot</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://sananaz00.github.io/book_writing_hackathon/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://sananaz00.github.io/book_writing_hackathon/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://sananaz00.github.io/book_writing_hackathon/docs/systems/building-rag-chatbot"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Building the RAG Chatbot Foundation | AI-Powered Book with RAG Chatbot"><meta data-rh="true" name="description" content="Hero Insight"><meta data-rh="true" property="og:description" content="Hero Insight"><link data-rh="true" rel="icon" href="/book_writing_hackathon/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://sananaz00.github.io/book_writing_hackathon/docs/systems/building-rag-chatbot"><link data-rh="true" rel="alternate" href="https://sananaz00.github.io/book_writing_hackathon/docs/systems/building-rag-chatbot" hreflang="en"><link data-rh="true" rel="alternate" href="https://sananaz00.github.io/book_writing_hackathon/docs/systems/building-rag-chatbot" hreflang="x-default"><link rel="stylesheet" href="/book_writing_hackathon/assets/css/styles.0a51bcce.css">
<script src="/book_writing_hackathon/assets/js/runtime~main.60b905dd.js" defer="defer"></script>
<script src="/book_writing_hackathon/assets/js/main.09d01659.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/book_writing_hackathon/"><div class="navbar__logo"><img src="/book_writing_hackathon/img/logo.svg" alt="AI Book Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/book_writing_hackathon/img/logo.svg" alt="AI Book Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AI Book</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/book_writing_hackathon/docs/foundations/ai-powered-documentation">Book</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/SANANAZ00/book_writing_hackathon" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book_writing_hackathon/docs/foundations/ai-powered-documentation">foundations</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/book_writing_hackathon/docs/intro">The AI-Powered Learning Journey</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/book_writing_hackathon/docs/systems/environment-setup">systems</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book_writing_hackathon/docs/systems/environment-setup">Setting Up the Development Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book_writing_hackathon/docs/systems/content-generation">Creating AI-Generated Content Systems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/book_writing_hackathon/docs/systems/building-rag-chatbot">Building the RAG Chatbot Foundation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book_writing_hackathon/docs/systems/fastapi-backend">FastAPI Backend Setup and Architecture</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">systems</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Building the RAG Chatbot Foundation</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="container container--fluid"><h1 id="building-the-rag-chatbot-foundation">Building the RAG Chatbot Foundation</h1>
<h2 id="hero-insight">Hero Insight</h2>
<p>Transform static documentation into an intelligent, conversational assistant that understands and responds to complex queries with contextual precision.</p>
<h2 id="purpose-of-this-chapter">Purpose of This Chapter</h2>
<p>You will build the foundational RAG (Retrieval-Augmented Generation) chatbot system that can answer questions about your documentation content with accuracy and contextual awareness.</p>
<h2 id="deep-breakdown">Deep Breakdown</h2>
<h3 id="rag-chatbot-architecture">RAG Chatbot Architecture</h3>
<p>A complete RAG chatbot system consists of several interconnected components:</p>
<h4 id="1-frontend-interface">1. Frontend Interface</h4>
<ul>
<li><strong>Chat Widget</strong>: Floating or integrated chat interface</li>
<li><strong>Message Display</strong>: Proper formatting for user and AI messages</li>
<li><strong>Input Handling</strong>: Text input with send functionality</li>
<li><strong>Loading States</strong>: Visual feedback during processing</li>
<li><strong>Citation Display</strong>: Showing sources for AI responses</li>
</ul>
<h4 id="2-backend-api-layer">2. Backend API Layer</h4>
<ul>
<li><strong>Message Processing</strong>: Handling user queries and context</li>
<li><strong>Content Retrieval</strong>: Fetching relevant documentation</li>
<li><strong>Response Generation</strong>: Creating contextual responses</li>
<li><strong>Conversation Management</strong>: Maintaining dialogue history</li>
<li><strong>Error Handling</strong>: Graceful degradation for failures</li>
</ul>
<h4 id="3-rag-pipeline">3. RAG Pipeline</h4>
<ul>
<li><strong>Query Processing</strong>: Understanding user questions</li>
<li><strong>Vector Search</strong>: Finding relevant documentation chunks</li>
<li><strong>Context Assembly</strong>: Combining retrieved content</li>
<li><strong>Response Generation</strong>: Creating final answers</li>
<li><strong>Source Attribution</strong>: Providing citations</li>
</ul>
<h3 id="implementing-the-rag-backend">Implementing the RAG Backend</h3>
<h4 id="core-rag-service">Core RAG Service</h4>
<pre><code class="language-python">import openai
from typing import List, Dict, Optional, Tuple
from qdrant_client import QdrantClient
from qdrant_client.http import models
import tiktoken

class RAGService:
    def __init__(self, qdrant_url: str, qdrant_api_key: str, openai_api_key: str):
        self.qdrant_client = QdrantClient(
            url=qdrant_url,
            api_key=qdrant_api_key,
            prefer_grpc=True
        )
        openai.api_key = openai_api_key
        self.encoder = tiktoken.encoding_for_model(&quot;gpt-3.5-turbo&quot;)

    def retrieve_relevant_content(
        self,
        query: str,
        limit: int = 5,
        score_threshold: float = 0.3
    ) -&gt; List[Dict]:
        &quot;&quot;&quot;
        Retrieve relevant content from vector database
        &quot;&quot;&quot;
        # Generate embedding for query
        response = openai.Embedding.create(
            input=query,
            model=&quot;text-embedding-ada-002&quot;
        )
        query_embedding = response[&#x27;data&#x27;][0][&#x27;embedding&#x27;]

        # Search in Qdrant
        search_results = self.qdrant_client.search(
            collection_name=&quot;documentation&quot;,
            query_vector=query_embedding,
            limit=limit,
            score_threshold=score_threshold,
            with_payload=True
        )

        return [
            {
                &#x27;content&#x27;: result.payload[&#x27;content&#x27;],
                &#x27;metadata&#x27;: result.payload.get(&#x27;metadata&#x27;, {}),
                &#x27;score&#x27;: result.score
            }
            for result in search_results
        ]

    def generate_response(
        self,
        query: str,
        context_chunks: List[Dict],
        conversation_history: Optional[List[Dict]] = None
    ) -&gt; str:
        &quot;&quot;&quot;
        Generate contextual response using retrieved content
        &quot;&quot;&quot;
        # Limit context to fit within token limits
        context = self._assemble_context(context_chunks)

        # Build conversation messages
        messages = [
            {
                &quot;role&quot;: &quot;system&quot;,
                &quot;content&quot;: f&quot;You are an AI assistant for documentation. Use the following context to answer questions: {context}&quot;
            }
        ]

        if conversation_history:
            messages.extend(conversation_history)

        messages.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: query})

        response = openai.ChatCompletion.create(
            model=&quot;gpt-3.5-turbo&quot;,
            messages=messages,
            temperature=0.7,
            max_tokens=500
        )

        return response.choices[0].message.content

    def _assemble_context(self, chunks: List[Dict]) -&gt; str:
        &quot;&quot;&quot;
        Assemble context from retrieved chunks, respecting token limits
        &quot;&quot;&quot;
        context_parts = []
        total_tokens = 0
        max_tokens = 3000  # Leave room for conversation and response

        for chunk in chunks:
            chunk_text = f&quot;Source: {chunk.get(&#x27;metadata&#x27;, {}).get(&#x27;source&#x27;, &#x27;Unknown&#x27;)}\nContent: {chunk[&#x27;content&#x27;]}\n\n&quot;
            chunk_tokens = len(self.encoder.encode(chunk_text))

            if total_tokens + chunk_tokens &gt; max_tokens:
                break

            context_parts.append(chunk_text)
            total_tokens += chunk_tokens

        return &quot;&quot;.join(context_parts)
</code></pre>
<h4 id="fastapi-rag-endpoints">FastAPI RAG Endpoints</h4>
<pre><code class="language-python">from fastapi import APIRouter, HTTPException, Depends
from pydantic import BaseModel
from typing import List, Optional

router = APIRouter()

class ChatRequest(BaseModel):
    message: str
    selected_text: Optional[str] = None
    conversation_history: Optional[List[Dict]] = []

class ChatResponse(BaseModel):
    response: str
    sources: List[Dict]
    query: str

@router.post(&quot;/chat&quot;, response_model=ChatResponse)
async def chat_endpoint(request: ChatRequest):
    try:
        rag_service = RAGService(
            qdrant_url=os.getenv(&quot;QDRANT_URL&quot;),
            qdrant_api_key=os.getenv(&quot;QDRANT_API_KEY&quot;),
            openai_api_key=os.getenv(&quot;OPENAI_API_KEY&quot;)
        )

        # If selected_text is provided, only search within that content
        if request.selected_text:
            # For selected text only, we&#x27;ll use a different approach
            # This would involve creating a temporary embedding of the selected text
            context_chunks = [{
                &#x27;content&#x27;: request.selected_text,
                &#x27;metadata&#x27;: {&#x27;source&#x27;: &#x27;user_selected_text&#x27;},
                &#x27;score&#x27;: 1.0
            }]
        else:
            # Normal RAG search
            context_chunks = rag_service.retrieve_relevant_content(request.message)

        response = rag_service.generate_response(
            query=request.message,
            context_chunks=context_chunks,
            conversation_history=request.conversation_history
        )

        sources = [chunk[&#x27;metadata&#x27;] for chunk in context_chunks]

        return ChatResponse(
            response=response,
            sources=sources,
            query=request.message
        )
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
</code></pre>
<h3 id="frontend-chat-widget-implementation">Frontend Chat Widget Implementation</h3>
<h4 id="react-chat-widget-component">React Chat Widget Component</h4>
<pre><code class="language-jsx">import React, { useState, useRef, useEffect } from &#x27;react&#x27;;

const ChatWidget = ({ selectedText }) =&gt; {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([]);
  const [inputValue, setInputValue] = useState(&#x27;&#x27;);
  const [isLoading, setIsLoading] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () =&gt; {
    messagesEndRef.current?.scrollIntoView({ behavior: &quot;smooth&quot; });
  };

  useEffect(() =&gt; {
    scrollToBottom();
  }, [messages]);

  const handleSendMessage = async () =&gt; {
    if (!inputValue.trim() || isLoading) return;

    const userMessage = { role: &#x27;user&#x27;, content: inputValue, timestamp: new Date() };
    setMessages(prev =&gt; [...prev, userMessage]);
    setInputValue(&#x27;&#x27;);
    setIsLoading(true);

    try {
      const response = await fetch(&#x27;/api/chat&#x27;, {
        method: &#x27;POST&#x27;,
        headers: { &#x27;Content-Type&#x27;: &#x27;application/json&#x27; },
        body: JSON.stringify({
          message: inputValue,
          selected_text: selectedText,
          conversation_history: messages.map(msg =&gt; ({
            role: msg.role,
            content: msg.content
          }))
        })
      });

      const data = await response.json();

      const aiMessage = {
        role: &#x27;assistant&#x27;,
        content: data.response,
        sources: data.sources,
        timestamp: new Date()
      };

      setMessages(prev =&gt; [...prev, aiMessage]);
    } catch (error) {
      console.error(&#x27;Error sending message:&#x27;, error);
      setMessages(prev =&gt; [...prev, {
        role: &#x27;assistant&#x27;,
        content: &#x27;Sorry, I encountered an error. Please try again.&#x27;,
        timestamp: new Date()
      }]);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyDown = (e) =&gt; {
    if (e.key === &#x27;Enter&#x27; &amp;&amp; !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  return (
    &lt;div className={`chat-widget ${isOpen ? &#x27;open&#x27; : &#x27;closed&#x27;}`}&gt;
      &lt;button
        className=&quot;chat-toggle&quot;
        onClick={() =&gt; setIsOpen(!isOpen)}
      &gt;
        üí¨ AI Assistant
      &lt;/button&gt;

      {isOpen &amp;&amp; (
        &lt;div className=&quot;chat-container&quot;&gt;
          &lt;div className=&quot;chat-header&quot;&gt;
            &lt;h3&gt;Documentation Assistant&lt;/h3&gt;
            &lt;button
              className=&quot;close-button&quot;
              onClick={() =&gt; setIsOpen(false)}
            &gt;
              √ó
            &lt;/button&gt;
          &lt;/div&gt;

          &lt;div className=&quot;chat-messages&quot;&gt;
            {messages.map((msg, index) =&gt; (
              &lt;div key={index} className={`message ${msg.role}`}&gt;
                &lt;div className=&quot;message-content&quot;&gt;
                  {msg.content}
                  {msg.sources &amp;&amp; msg.sources.length &gt; 0 &amp;&amp; (
                    &lt;div className=&quot;sources&quot;&gt;
                      &lt;small&gt;Sources: {msg.sources.map(s =&gt; s.source).join(&#x27;, &#x27;)}&lt;/small&gt;
                    &lt;/div&gt;
                  )}
                &lt;/div&gt;
              &lt;/div&gt;
            ))}
            {isLoading &amp;&amp; (
              &lt;div className=&quot;message assistant&quot;&gt;
                &lt;div className=&quot;message-content&quot;&gt;
                  &lt;div className=&quot;typing-indicator&quot;&gt;
                    &lt;span&gt;&lt;/span&gt;
                    &lt;span&gt;&lt;/span&gt;
                    &lt;span&gt;&lt;/span&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            )}
            &lt;div ref={messagesEndRef} /&gt;
          &lt;/div&gt;

          &lt;div className=&quot;chat-input&quot;&gt;
            &lt;textarea
              value={inputValue}
              onChange={(e) =&gt; setInputValue(e.target.value)}
              onKeyDown={handleKeyDown}
              placeholder=&quot;Ask about the documentation...&quot;
              rows=&quot;3&quot;
            /&gt;
            &lt;button
              onClick={handleSendMessage}
              disabled={isLoading || !inputValue.trim()}
            &gt;
              Send
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
};

export default ChatWidget;
</code></pre>
<h3 id="advanced-rag-features">Advanced RAG Features</h3>
<h4 id="selected-text-only-mode">Selected Text Only Mode</h4>
<p>Implement the &quot;answer only from selected text&quot; functionality:</p>
<pre><code class="language-python">def generate_response_from_selection(
    self,
    query: str,
    selected_text: str,
    conversation_history: Optional[List[Dict]] = None
) -&gt; str:
    &quot;&quot;&quot;
    Generate response based only on user-selected text
    &quot;&quot;&quot;
    # Create a system message that restricts the AI to only use the selected text
    system_message = f&quot;&quot;&quot;
    You are an AI assistant that can only answer questions based on the following text:
    {selected_text}

    Do not use any other knowledge or information.
    If the answer cannot be found in the provided text, say so explicitly.
    &quot;&quot;&quot;

    messages = [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_message}]

    if conversation_history:
        messages.extend(conversation_history)

    messages.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: query})

    response = openai.ChatCompletion.create(
        model=&quot;gpt-3.5-turbo&quot;,
        messages=messages,
        temperature=0.3,  # Lower temperature for more consistent responses
        max_tokens=500
    )

    return response.choices[0].message.content
</code></pre>
<h4 id="context-aware-response-generation">Context-Aware Response Generation</h4>
<p>Enhance responses with better context awareness:</p>
<pre><code class="language-python">def generate_context_aware_response(
    self,
    query: str,
    context_chunks: List[Dict],
    conversation_history: Optional[List[Dict]] = None,
    user_intent: Optional[str] = None
) -&gt; Dict:
    &quot;&quot;&quot;
    Generate response with enhanced context awareness
    &quot;&quot;&quot;
    # Analyze user intent if not provided
    if not user_intent:
        intent_prompt = f&quot;Analyze the user&#x27;s question &#x27;{query}&#x27; and identify the intent. Possible intents: explanation, example, troubleshooting, comparison, definition.&quot;

        intent_response = openai.ChatCompletion.create(
            model=&quot;gpt-3.5-turbo&quot;,
            messages=[{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: intent_prompt}],
            temperature=0.1
        )
        user_intent = intent_response.choices[0].message.content.strip()

    # Build context based on intent
    context = self._build_intentional_context(context_chunks, user_intent)

    # Generate response with intent-aware system message
    system_message = f&quot;&quot;&quot;
    You are a documentation assistant helping users understand technical content.
    The user&#x27;s intent is: {user_intent}
    Use the following context to provide a helpful response:
    {context}
    &quot;&quot;&quot;

    messages = [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_message}]

    if conversation_history:
        messages.extend(conversation_history)

    messages.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: query})

    response = openai.ChatCompletion.create(
        model=&quot;gpt-4&quot;,  # Use more capable model for complex queries
        messages=messages,
        temperature=0.7,
        max_tokens=800
    )

    return {
        &#x27;response&#x27;: response.choices[0].message.content,
        &#x27;intent&#x27;: user_intent,
        &#x27;confidence&#x27;: 0.8  # Placeholder for actual confidence scoring
    }
</code></pre>
<h3 id="performance-optimization">Performance Optimization</h3>
<h4 id="caching-strategies">Caching Strategies</h4>
<p>Implement caching to improve response times:</p>
<pre><code class="language-python">import redis
import pickle
from functools import wraps

class RAGCache:
    def __init__(self, redis_url: str = &quot;redis://localhost:6379&quot;):
        self.redis_client = redis.from_url(redis_url)

    def get_cached_response(self, query_hash: str) -&gt; Optional[str]:
        cached = self.redis_client.get(f&quot;rag_response:{query_hash}&quot;)
        return pickle.loads(cached) if cached else None

    def cache_response(self, query_hash: str, response: str, ttl: int = 3600):
        self.redis_client.setex(
            f&quot;rag_response:{query_hash}&quot;,
            ttl,
            pickle.dumps(response)
        )

def with_cache(func):
    @wraps(func)
    def wrapper(self, *args, **kwargs):
        query = kwargs.get(&#x27;query&#x27;) or args[0] if args else None
        if query:
            cache_key = f&quot;rag:{hash(query)}&quot;
            cached = self.cache.get_cached_response(cache_key)
            if cached:
                return cached

        result = func(self, *args, **kwargs)

        if query:
            self.cache.cache_response(cache_key, result)

        return result
    return wrapper
</code></pre>
<h2 id="-uiux-angle">üé® UI/UX Angle</h2>
<p>The chatbot interface should feel natural and helpful, with clear visual indicators for different message types, loading states, and source citations. The interaction should feel conversational while maintaining the professional tone of documentation.</p>
<h2 id="-real-world-example">üìò Real-World Example</h2>
<p>A RAG chatbot for an API documentation site:</p>
<ol>
<li>User asks: &quot;How do I implement authentication?&quot;</li>
<li>System retrieves relevant sections about authentication methods</li>
<li>AI generates: &quot;To implement authentication, you can use API keys in the header or OAuth tokens...&quot;</li>
<li>Response includes citations to specific documentation sections</li>
<li>User can ask follow-up questions with context maintained</li>
</ol>
<h2 id="Ô∏è-common-mistakes--fixes">‚ö†Ô∏è Common Mistakes &amp; Fixes</h2>
<h3 id="mistake-not-handling-token-limits-properly-in-context-assembly">Mistake: Not handling token limits properly in context assembly</h3>
<p><strong>Fix</strong>: Implement intelligent context truncation that preserves important information.</p>
<h3 id="mistake-providing-responses-without-source-attribution">Mistake: Providing responses without source attribution</h3>
<p><strong>Fix</strong>: Always include citations to the documentation sources used.</p>
<h3 id="mistake-not-differentiating-between-selected-text-and-full-document-responses">Mistake: Not differentiating between selected-text and full-document responses</h3>
<p><strong>Fix</strong>: Implement clear visual and functional differences between modes.</p>
<h2 id="-micro-exercises">üß™ Micro-Exercises</h2>
<ol>
<li><strong>Exercise</strong>: Implement a basic RAG service that retrieves and generates responses from sample content.</li>
<li><strong>Exercise</strong>: Create a simple chat interface that integrates with your RAG backend.</li>
</ol>
<h2 id="-reflection-prompts">üß≠ Reflection Prompts</h2>
<ul>
<li>How do users currently find information in your documentation?</li>
<li>What challenges do they face with traditional search?</li>
<li>How might a conversational interface improve their experience?</li>
</ul>
<h2 id="end-of-chapter-summary">End-of-Chapter Summary</h2>
<ul>
<li>RAG chatbots combine retrieval and generation for contextual responses</li>
<li>Proper architecture includes frontend, backend, and RAG pipeline components</li>
<li>Selected text functionality requires special handling</li>
<li>Performance optimization is crucial for production use</li>
<li>The system transforms static documentation into interactive assistance</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/SANANAZ00/book_writing_hackathon/edit/main/docs/systems/building-rag-chatbot.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/book_writing_hackathon/docs/systems/content-generation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Creating AI-Generated Content Systems</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/book_writing_hackathon/docs/systems/fastapi-backend"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FastAPI Backend Setup and Architecture</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hero-insight" class="table-of-contents__link toc-highlight">Hero Insight</a></li><li><a href="#purpose-of-this-chapter" class="table-of-contents__link toc-highlight">Purpose of This Chapter</a></li><li><a href="#deep-breakdown" class="table-of-contents__link toc-highlight">Deep Breakdown</a><ul><li><a href="#rag-chatbot-architecture" class="table-of-contents__link toc-highlight">RAG Chatbot Architecture</a></li><li><a href="#implementing-the-rag-backend" class="table-of-contents__link toc-highlight">Implementing the RAG Backend</a></li><li><a href="#frontend-chat-widget-implementation" class="table-of-contents__link toc-highlight">Frontend Chat Widget Implementation</a></li><li><a href="#advanced-rag-features" class="table-of-contents__link toc-highlight">Advanced RAG Features</a></li><li><a href="#performance-optimization" class="table-of-contents__link toc-highlight">Performance Optimization</a></li></ul></li><li><a href="#-uiux-angle" class="table-of-contents__link toc-highlight">üé® UI/UX Angle</a></li><li><a href="#-real-world-example" class="table-of-contents__link toc-highlight">üìò Real-World Example</a></li><li><a href="#Ô∏è-common-mistakes--fixes" class="table-of-contents__link toc-highlight">‚ö†Ô∏è Common Mistakes &amp; Fixes</a><ul><li><a href="#mistake-not-handling-token-limits-properly-in-context-assembly" class="table-of-contents__link toc-highlight">Mistake: Not handling token limits properly in context assembly</a></li><li><a href="#mistake-providing-responses-without-source-attribution" class="table-of-contents__link toc-highlight">Mistake: Providing responses without source attribution</a></li><li><a href="#mistake-not-differentiating-between-selected-text-and-full-document-responses" class="table-of-contents__link toc-highlight">Mistake: Not differentiating between selected-text and full-document responses</a></li></ul></li><li><a href="#-micro-exercises" class="table-of-contents__link toc-highlight">üß™ Micro-Exercises</a></li><li><a href="#-reflection-prompts" class="table-of-contents__link toc-highlight">üß≠ Reflection Prompts</a></li><li><a href="#end-of-chapter-summary" class="table-of-contents__link toc-highlight">End-of-Chapter Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/book_writing_hackathon/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/book_writing_hackathon/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/SANANAZ00/book_writing_hackathon" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 AI-Powered Book Project. Built with Docusaurus.</div></div></div></footer><div class="chatbotWidget_q_OK"><button class="chatToggle_zvSz" aria-label="Open chat">üí¨ AI Assistant</button></div></div>
</body>
</html>